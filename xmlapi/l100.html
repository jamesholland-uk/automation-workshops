<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. XML API L100 &mdash; Automation Workshops  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. XML API L200" href="l200.html" />
    <link rel="prev" title="Automation Workshops" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Automation Workshops
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PAN-OS API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. XML API L100</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#store-our-firewall-s-ip-as-a-variable">1.1. Store our firewall’s IP as a variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-your-api-key">1.2. Generate your API key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-your-first-real-api-call">1.3. Make your first real API call</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-firewall-system-info">1.4. Get firewall system info</a></li>
<li class="toctree-l2"><a class="reference internal" href="#show-the-routing-table">1.5. Show the routing table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#show-the-rulebase-configuration">1.6. Show the rulebase configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#show-the-rulebase-hit-counts">1.7. Show the rulebase hit counts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backup-export-configuration">1.8. Backup/export configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-id">1.9. User-ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#find-an-api-command-cli-debug">1.10. Find An API Command - CLI Debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#find-an-api-command-api-browser">1.11. Find An API Command - API Browser</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l200.html">2. XML API L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="l300.html">3. XML API L300</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PAN-OS Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ansible/l100.html">1. Ansible L100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible/l200.html">2. Ansible L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible/l300.html">3. Ansible L300</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PAN-OS Terraform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l100.html">1. Terraform L100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l200.html">2. Terraform L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l300.html">3. Terraform L300</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Automation Workshops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">1. </span>XML API L100</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/xmlapi/l100.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="xml-api-l100">
<h1><span class="section-number">1. </span>XML API L100<a class="headerlink" href="#xml-api-l100" title="Permalink to this heading"></a></h1>
<p>Hands-on tasks for this workshop will be performing XML API calls against a PAN-OS firewall, from your command-line environment, using the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command. For each task, you can use the copy button to take the command into the clipboard, but ensure you replace any UPPERCASE_VARIABLES with your own values.</p>
<p>Assumptions: A host with <code class="docutils literal notranslate"><span class="pre">curl</span></code> installed, access to a PAN-OS next-generation firewall from your host.</p>
<dl class="simple">
<dt>Note:</dt><dd><ul class="simple">
<li><p>Lookout for text in uppercase, such as <code class="docutils literal notranslate"><span class="pre">YOUR_FIREWALL_IP</span></code>, and replace the text with the relevant value for your environment.</p></li>
<li><p>Commands you could/should execute are denoted with <code class="docutils literal notranslate"><span class="pre">$</span></code> at the start, and have copy buttons; other text boxes show expected outputs.</p></li>
<li><p>You may wish to have a text editor open on your machine, to amend copied commands before pasting them into the host’s CLI.</p></li>
</ul>
</dd>
</dl>
<section id="store-our-firewall-s-ip-as-a-variable">
<h2><span class="section-number">1.1. </span>Store our firewall’s IP as a variable<a class="headerlink" href="#store-our-firewall-s-ip-as-a-variable" title="Permalink to this heading"></a></h2>
<p>First, to make our lives easier, we will assign the management IP address of the firewall to a variable, so we can easily refer to it in our API calls.</p>
<p>Today, in this environment, we will assign the API key value to a variable called <code class="docutils literal notranslate"><span class="pre">host</span></code>, to be used in future API calls. The export command stores the value of <code class="docutils literal notranslate"><span class="pre">host</span></code> in memory for th duration of the CLI session.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ export host=YOUR_FIREWALL_IP
</pre></div>
</div>
</section>
<section id="generate-your-api-key">
<h2><span class="section-number">1.2. </span>Generate your API key<a class="headerlink" href="#generate-your-api-key" title="Permalink to this heading"></a></h2>
<p>Before you can make any API calls, you need to generate an API key. Your API key will allow you to authenticate and authorise yourself for future API calls.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=keygen&amp;user=YOUR_ADMIN_PASSWORD&amp;password=YOUR_ADMIN_PASSWORD&quot; https://$host/api
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">response</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span><span class="o">&gt;&lt;</span><span class="n">result</span><span class="o">&gt;&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="n">LUFRPT16V1ZzaHNFYVJEdlZnb3Buc1dJRWtCVFFPYjFXTzI2N1phVzRsMg</span><span class="o">==&lt;/</span><span class="n">key</span><span class="o">&gt;&lt;/</span><span class="n">result</span><span class="o">&gt;&lt;/</span><span class="n">response</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In production environments, credentials should be stored, accessed and used securely, per the security policy and compliance requirements. Today, in this environment, we will assign the API key value to a variable to be used in future API calls. Take the characters between the <code class="docutils literal notranslate"><span class="pre">key</span></code> tags from the previous output as your API key, in the example above this is the characters from <code class="docutils literal notranslate"><span class="pre">LUFRPT16...</span></code> to <code class="docutils literal notranslate"><span class="pre">...Mg==</span></code></p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ export key=YOUR_API_KEY
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export key=LUFRPT16V1ZzaHNFYVJEdlZnb3Buc1dJRWtCVFFPYjFXTzI2N1phVzRsMg==
</pre></div>
</div>
</section>
<section id="make-your-first-real-api-call">
<h2><span class="section-number">1.3. </span>Make your first real API call<a class="headerlink" href="#make-your-first-real-api-call" title="Permalink to this heading"></a></h2>
<p>Your first API call will tell you if the firewall is in a ready and operational state. This operational command is useful to know if the firewall has been recently rebooted, or in the case of software firewalls like VM-Series or CN-Series, recently created. The answer should be <code class="docutils literal notranslate"><span class="pre">yes</span></code>, within the XML-formatted response.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;chassis-ready&gt;&lt;/chassis-ready&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;response status=&quot;success&quot;&gt;&lt;result&gt;&lt;![CDATA[yes
]]&gt;&lt;/result&gt;&lt;/response
</pre></div>
</div>
</section>
<section id="get-firewall-system-info">
<h2><span class="section-number">1.4. </span>Get firewall system info<a class="headerlink" href="#get-firewall-system-info" title="Permalink to this heading"></a></h2>
<p>Next, retrieve information about the firewall system. This too is an operational command, as shown by <code class="docutils literal notranslate"><span class="pre">type=op</span></code> within the API call. The <code class="docutils literal notranslate"><span class="pre">cmd=</span></code> portion contains the operational command we want to execute.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;system&gt;&lt;info&gt;&lt;/info&gt;&lt;/system&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="show-the-routing-table">
<h2><span class="section-number">1.5. </span>Show the routing table<a class="headerlink" href="#show-the-routing-table" title="Permalink to this heading"></a></h2>
<p>Another useful operational command is to display the routing table.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;routing&gt;&lt;route&gt;&lt;/route&gt;&lt;/routing&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="show-the-rulebase-configuration">
<h2><span class="section-number">1.6. </span>Show the rulebase configuration<a class="headerlink" href="#show-the-rulebase-configuration" title="Permalink to this heading"></a></h2>
<p>Now we look at the firewall configuration. Notice the type of API call this time is <code class="docutils literal notranslate"><span class="pre">type=config</span></code>, and the action is <code class="docutils literal notranslate"><span class="pre">get</span></code>, which as expected tells the API we want to do a read operation on the configuration. The <code class="docutils literal notranslate"><span class="pre">xpath</span></code> is then used to navigate down through the XML configuration file structure to specifically find the rules within the security policy.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=config&amp;action=get&amp;xpath=/config/devices/entry[@name=&#39;localhost.localdomain&#39;]/vsys/entry[@name=&#39;vsys1&#39;]/rulebase/security/rules&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="show-the-rulebase-hit-counts">
<h2><span class="section-number">1.7. </span>Show the rulebase hit counts<a class="headerlink" href="#show-the-rulebase-hit-counts" title="Permalink to this heading"></a></h2>
<p>We’ve seen the rulebase from the configuration, but if we wanted to programmatically retrieve the hit counts for each rule, that would be an operational command.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;rule-hit-count&gt;&lt;vsys&gt;&lt;vsys-name&gt;&lt;entry name=&#39;vsys1&#39;&gt;&lt;rule-base&gt;&lt;entry name=&#39;security&#39;&gt;&lt;rules&gt;&lt;all/&gt;&lt;/rules&gt;&lt;/entry&gt;&lt;/rule-base&gt;&lt;/entry&gt;&lt;/vsys-name&gt;&lt;/vsys&gt;&lt;/rule-hit-count&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="backup-export-configuration">
<h2><span class="section-number">1.8. </span>Backup/export configuration<a class="headerlink" href="#backup-export-configuration" title="Permalink to this heading"></a></h2>
<p>This is a common API call, given how many people have requirements to automate backing up configurations. This uses <code class="docutils literal notranslate"><span class="pre">type=export</span></code> to signify we are exporting something, and <code class="docutils literal notranslate"><span class="pre">category=configuration</span></code> describes the exact item we want to export.</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=export&amp;category=configuration&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="user-id">
<h2><span class="section-number">1.9. </span>User-ID<a class="headerlink" href="#user-id" title="Permalink to this heading"></a></h2>
<p>A frequent use case is to register user-to-IP mappings. The first task here, another operational command, shows the current user-to-IP mapping table</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;user&gt;&lt;ip-user-mapping&gt;&lt;all/&gt;&lt;/ip-user-mapping&gt;&lt;/user&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
<p>The next API call registers a username to an IP address. This uses <code class="docutils literal notranslate"><span class="pre">type=user-id</span></code>. Note we pass in the username, the IP address they are currently using, and a timeout value (in seconds).</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=user-id&amp;cmd=&lt;uid-message&gt;&lt;version&gt;2.0&lt;/version&gt;&lt;type&gt;update&lt;/type&gt;&lt;payload&gt;&lt;login&gt;&lt;entry name=\&quot;NewUser\&quot; ip=\&quot;10.50.100.9\&quot; timeout=\&quot;120\&quot;/&gt;&lt;/login&gt;&lt;/payload&gt;&lt;/uid-message&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
<p>Replaying the API call to show the mapping table should now display the new user</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -kd &quot;type=op&amp;cmd=&lt;show&gt;&lt;user&gt;&lt;ip-user-mapping&gt;&lt;all/&gt;&lt;/ip-user-mapping&gt;&lt;/user&gt;&lt;/show&gt;&amp;key=$key&quot; https://$host/api
</pre></div>
</div>
</section>
<section id="find-an-api-command-cli-debug">
<h2><span class="section-number">1.10. </span>Find An API Command - CLI Debug<a class="headerlink" href="#find-an-api-command-cli-debug" title="Permalink to this heading"></a></h2>
<p>One way to find an API call for specific operation is to observe or “debug” the CLI, which itself uses the XML API. Once debugging is enabled, an XML API call will be displayed when a CLI command is executed.</p>
<p>Using the example of our first API call in this workshop, the CLI command equivalent is “show chassis-ready”. When debugged, this gives the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll">admin@firewall&gt; debug cli on
</span><span class="hll">admin@firewall&gt; show chassis-ready
</span>(container-tag: chassis-ready pop-tag:)
((eol-matched: . #t) (context-inserted-at-end-p: . #f))

<span class="hll">&lt;request cmd=&quot;op&quot; cookie=&quot;5461146855105504&quot; uid=&quot;1000&quot;&gt;&lt;operations&gt;&lt;show&gt;&lt;chassis-ready/&gt;&lt;/show&gt;&lt;/operations&gt;&lt;/request&gt;
</span>
2021-11-05 12:56:57
&lt;response status=&quot;success&quot;&gt;&lt;result&gt;&lt;![CDATA[yes]]&gt;&lt;/result&gt;&lt;/response&gt;

yes
</pre></div>
</div>
<p>Note the highlighted lines, first the command for turning on CLI debugging, then the execution the command of interest (<code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">chassis-ready</span></code>), then the observation of the XML API equivalent for the CLI command.</p>
<p>The XML required to make a call ourselves is between (but not including) the <code class="docutils literal notranslate"><span class="pre">&lt;operations&gt;&lt;/operations&gt;</span></code> tags. This gives us <code class="docutils literal notranslate"><span class="pre">&lt;show&gt;&lt;chassis-ready/&gt;&lt;/show&gt;</span></code>, which becomes the <code class="docutils literal notranslate"><span class="pre">cmd=</span></code> portion of the final API command:
<code class="docutils literal notranslate"><span class="pre">https://$host/api/?type=op&amp;cmd=&lt;show&gt;&lt;chassis-ready&gt;&lt;/chassis-ready&gt;&lt;/show&gt;&amp;key=$key</span></code></p>
<p>Connect to the firewall using SSH:</p>
<div class="copy-button highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh YOUR_ADMIN_USERNAME@$host
</pre></div>
</div>
<p>Then choose one (or more) of the following operational commands, debug the CLI, then create and execute XML API command equivalents. You may wish to use two CLI windows, your original CLI for performing XML API commands, and a second CLI for SSH to the firewall.</p>
<blockquote>
<div><ul class="simple">
<li><p>show system masterkey-properties</p></li>
<li><p>show arp all</p></li>
<li><p>show interface management</p></li>
<li><p>clear user-cache all</p></li>
</ul>
</div></blockquote>
</section>
<section id="find-an-api-command-api-browser">
<h2><span class="section-number">1.11. </span>Find An API Command - API Browser<a class="headerlink" href="#find-an-api-command-api-browser" title="Permalink to this heading"></a></h2>
<p>Another way to find an API call for specific operation is to use the API browser, which can be found at <code class="docutils literal notranslate"><span class="pre">https://firewall/api</span></code>. <strong>Once logged in to the web GUI</strong>, browse to <code class="docutils literal notranslate"><span class="pre">https://firewall/api</span></code> and a listing of the types of available XML API request types is displayed. Hyperlinks can be used to browse through the XML API request types until the required request format is found.</p>
<p>Again using the example of our first API call in this workshop, <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">chassis-ready</span></code>, click the <code class="docutils literal notranslate"><span class="pre">Operational</span> <span class="pre">Commands</span></code> link, then the <code class="docutils literal notranslate"><span class="pre">show</span></code> link, then the <code class="docutils literal notranslate"><span class="pre">chassis-ready</span></code> link. You will be shown the XML API format we observed in the CLI (<code class="docutils literal notranslate"><span class="pre">&lt;show&gt;&lt;chassis-ready/&gt;&lt;/show&gt;</span></code>), as well as the XML API URL structure (<code class="docutils literal notranslate"><span class="pre">/api/?type=op&amp;cmd=&lt;show&gt;&lt;chassis-ready&gt;&lt;/chassis-ready&gt;&lt;/show&gt;</span></code>). Clicking the hyperlinked XML API URL performs the API command and displays a result.</p>
<p>Choose one (or more) of the following operational commands, find the command in the API browser, then create and execute XML API command equivalents:</p>
<blockquote>
<div><ul class="simple">
<li><p>show clock</p></li>
<li><p>show admins all</p></li>
<li><p>clear counter all</p></li>
<li><p>show system disk-space</p></li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Automation Workshops" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="l200.html" class="btn btn-neutral float-right" title="2. XML API L200" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, James Holland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>