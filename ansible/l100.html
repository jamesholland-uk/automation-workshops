<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Ansible L100 &mdash; Automation Workshops  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Ansible L200" href="l200.html" />
    <link rel="prev" title="3. XML API L300" href="../xmlapi/l300.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Automation Workshops
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PAN-OS API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../xmlapi/l100.html">1. XML API L100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xmlapi/l200.html">2. XML API L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xmlapi/l300.html">3. XML API L300</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PAN-OS Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Ansible L100</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ansible-pre-flight-checks">1.1. Ansible pre-flight checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-ansible-playbooks">1.2. Download Ansible playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-inventory">1.3. Setup the inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-the-firewall-credentials">1.4. Prepare the firewall credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-our-first-ansible-playbook">1.5. Run our first Ansible playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next">1.6. Next?!?!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#todo">1.7. TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l200.html">2. Ansible L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="l300.html">3. Ansible L300</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PAN-OS Terraform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l100.html">1. Terraform L100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l200.html">2. Terraform L200</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/l300.html">3. Terraform L300</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Automation Workshops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">1. </span>Ansible L100</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ansible/l100.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ansible-l100">
<h1><span class="section-number">1. </span>Ansible L100<a class="headerlink" href="#ansible-l100" title="Permalink to this headline"></a></h1>
<p>Hands-on tasks for this workshop will be using Ansible playbooks against a PAN-OS firewall, from your command-line environment. For each task, you can use the copy button to take the command into the clipboard, but ensure you replace the {{ variables in braces }} with your own values.</p>
<p>Assumptions: A host with the following installed: curl, git, <a class="reference external" href="https://www.python.org/downloads">Python 3</a>, <a class="reference external" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-and-upgrading-ansible-with-pip">Ansible</a>, <a class="reference external" href="https://github.com/PaloAltoNetworks/pan-os-python">PAN-OS-Python</a>, <a class="reference external" href="https://github.com/PaloAltoNetworks/pan-os-ansible">PAN-OS Ansible Collection</a>, and all prerequisite requirements. Also, access to a PAN-OS next-generation firewall from your host.</p>
<dl class="simple">
<dt>Note:</dt><dd><ul class="simple">
<li><p>Where text is enclosed in {{ double braces }}, replace the text with the relevant value for your environment.</p></li>
<li><p>Commands you could/should execute are denoted with <code class="docutils literal notranslate"><span class="pre">$</span></code> at the start, other text boxes show expected outputs.</p></li>
</ul>
</dd>
</dl>
<section id="ansible-pre-flight-checks">
<h2><span class="section-number">1.1. </span>Ansible pre-flight checks<a class="headerlink" href="#ansible-pre-flight-checks" title="Permalink to this headline"></a></h2>
<p>First let’s check that Ansible is installed on our host.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook --version
</pre></div>
</div>
<p>The output should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="p">[</span><span class="n">core</span> <span class="mf">2.11.5</span><span class="p">]</span>
    <span class="n">config</span> <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">configured</span> <span class="n">module</span> <span class="n">search</span> <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/Users/jholland/.ansible/plugins/modules&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="p">]</span>
    <span class="n">ansible</span> <span class="n">python</span> <span class="n">module</span> <span class="n">location</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">ansible</span>
    <span class="n">ansible</span> <span class="n">collection</span> <span class="n">location</span> <span class="o">=</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">jholland</span><span class="o">/.</span><span class="n">ansible</span><span class="o">/</span><span class="n">collections</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">collections</span>
    <span class="n">executable</span> <span class="n">location</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span>
    <span class="n">python</span> <span class="n">version</span> <span class="o">=</span> <span class="mf">3.9.7</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Oct</span> <span class="mi">13</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">31</span><span class="p">)</span> <span class="p">[</span><span class="n">Clang</span> <span class="mf">13.0.0</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1300.0.29.3</span><span class="p">)]</span>
    <span class="n">jinja</span> <span class="n">version</span> <span class="o">=</span> <span class="mf">2.11.3</span>
    <span class="n">libyaml</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Then let’s check we have the PAN-OS Collection installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ansible-doc --list | grep paloaltonetworks.panos
</pre></div>
</div>
<p>The output should list al the modules in the PAN-OS Collection, and the end of the list should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_virtual_router</span>                           <span class="n">Confi</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_virtual_router_facts</span>                     <span class="n">Retri</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_virtual_wire</span>                             <span class="n">Confi</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_vlan</span>                                     <span class="n">Confi</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_vlan_interface</span>                           <span class="n">confi</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_vm_auth_key</span>                              <span class="n">Creat</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_zone</span>                                     <span class="n">confi</span><span class="o">...</span>
<span class="n">paloaltonetworks</span><span class="o">.</span><span class="n">panos</span><span class="o">.</span><span class="n">panos_zone_facts</span>                               <span class="n">Retri</span><span class="o">...</span>
</pre></div>
</div>
</section>
<section id="download-ansible-playbooks">
<h2><span class="section-number">1.2. </span>Download Ansible playbooks<a class="headerlink" href="#download-ansible-playbooks" title="Permalink to this headline"></a></h2>
<p>In this workshop, we’re going to be using playbooks from the <a class="reference external" href="https://github.com/PaloAltoNetworks/ansible-playbooks">repository of examples</a>, created by <a class="reference external" href="https://github.com/mrichardson03">Michael Richardson</a>. We’ll use git to download the playbooks…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/PaloAltoNetworks/ansible-playbooks
</pre></div>
</div>
<p>…then move into the playbooks directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ansible-playbooks
</pre></div>
</div>
</section>
<section id="setup-the-inventory">
<h2><span class="section-number">1.3. </span>Setup the inventory<a class="headerlink" href="#setup-the-inventory" title="Permalink to this headline"></a></h2>
<p>Ansible needs to know the details for the hosts against which it should execute playbooks. This <code class="docutils literal notranslate"><span class="pre">inventory</span></code> can take many formats and locations, and for this workshop we will use the inventory format from the example playbooks repository.</p>
<p>In the ansible-playbooks directory, the <code class="docutils literal notranslate"><span class="pre">inventory</span></code> file contains a list of available hosts for us to run playbooks against:
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat inventory
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">firewall</span>
<span class="n">ha_pair</span>

<span class="n">panorama</span>
<span class="n">panorama_ha_pair</span>
</pre></div>
</div>
<p>All our example playbooks begin with a reference to a default target host from our <code class="docutils literal notranslate"><span class="pre">inventory</span></code> file, which is <code class="docutils literal notranslate"><span class="pre">firewall</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="s1">&#39;{{ target | default(&quot;firewall&quot;) }}&#39;</span>
</pre></div>
</div>
<p>We provide the <code class="docutils literal notranslate"><span class="pre">firewall</span></code>’s IP address in the <code class="docutils literal notranslate"><span class="pre">host_vars/lab-fw.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat host_vars/lab-fw.yml
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">ip_address</span><span class="p">:</span> <span class="s1">&#39;192.168.55.10&#39;</span>
</pre></div>
</div>
<p>Change the IP address in this file to match your firewalls’s management IP address:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat &gt; host_vars/lab-fw.yml &lt;&lt;EOL
---
ip_address: &#39;{{ your firewall management IP }}&#39;
EOL
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat host_vars/lab-fw.yml
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">ip_address</span><span class="p">:</span> <span class="s1">&#39;{{ your firewall management IP }}&#39;</span>
</pre></div>
</div>
</section>
<section id="prepare-the-firewall-credentials">
<h2><span class="section-number">1.4. </span>Prepare the firewall credentials<a class="headerlink" href="#prepare-the-firewall-credentials" title="Permalink to this headline"></a></h2>
<p>Before you can execute any Ansible playbooks, you need to be able to login to the firewall. We will store the admin username and admin password as variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export panos_username={{ your-admin-username }}
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export panos_password={{ your-admin-password }}
</pre></div>
</div>
<p>In production environments, credentials should be stored, accessed and used securely, per the security policy and compliance requirements. Today, in this enviornment, we will use these credentials stored in variables for executing Ansible playbooks.</p>
</section>
<section id="run-our-first-ansible-playbook">
<h2><span class="section-number">1.5. </span>Run our first Ansible playbook<a class="headerlink" href="#run-our-first-ansible-playbook" title="Permalink to this headline"></a></h2>
<p>Our first playbook executes the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">chassis-ready</span></code> command. This is useful to ensure the firewall is ready to accept further operations such as configuration changes, software downloads and updgrades, and more. The <a class="reference external" href="https://github.com/PaloAltoNetworks/ansible-playbooks/blob/master/check_ready.yml">playbook</a> runs the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">chassis-ready</span></code> command on a loop until it gets the positive <code class="docutils literal notranslate"><span class="pre">yes</span></code> result that the firewall is ready.</p>
<p>Notice in the command below that we execute the <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> command, pass in the inventory using <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">inventory</span></code>, then specify the name of the playbook we want to run, <code class="docutils literal notranslate"><span class="pre">check_ready.yml</span></code>, and finally pass in the firewall credentials with <code class="docutils literal notranslate"><span class="pre">--extra-vars</span> <span class="pre">&quot;username=$panos_username</span> <span class="pre">password=$panos_password&quot;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook -i inventory check_ready.yml --extra-vars &quot;username=$panos_username password=$panos_password&quot;
</pre></div>
</div>
<p>The output should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PLAY</span> <span class="p">[</span><span class="n">firewall</span><span class="p">]</span> <span class="o">**************************************************************************************************</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">Gathering</span> <span class="n">Facts</span><span class="p">]</span> <span class="o">*******************************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">firewall</span><span class="p">]</span>

<span class="n">TASK</span> <span class="p">[</span><span class="n">Check</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="n">ready</span><span class="p">]</span> <span class="o">***************************************************************************</span>
<span class="n">ok</span><span class="p">:</span> <span class="p">[</span><span class="n">firewall</span><span class="p">]</span>

<span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">*******************************************************************************************************</span>
<span class="n">firewall</span>                   <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">2</span>    <span class="n">changed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">skipped</span><span class="o">=</span><span class="mi">0</span>    <span class="n">rescued</span><span class="o">=</span><span class="mi">0</span>    <span class="n">ignored</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="next">
<h2><span class="section-number">1.6. </span>Next?!?!<a class="headerlink" href="#next" title="Permalink to this headline"></a></h2>
</section>
<section id="todo">
<h2><span class="section-number">1.7. </span>TODO<a class="headerlink" href="#todo" title="Permalink to this headline"></a></h2>
<p>Get API key
Show system info
Show ready
Show route table
Show rules
Show rule hit count
Show applications
Show vulnerability signature list
Register a user-to-IP
Export config
Get tech-support file</p>
<p>Upgrade OS</p>
<p>&lt;&lt; simple bash script to do some changes, the commit and watch until finished &gt;&gt;
&lt;&lt; anothe bash script to get some info, pass to another call with a variable &gt;&gt;</p>
<p>Scripts - explain ideas of pre-caned config snippets, idea behind skillets etc, golden eval configs, etc</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../xmlapi/l300.html" class="btn btn-neutral float-left" title="3. XML API L300" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="l200.html" class="btn btn-neutral float-right" title="2. Ansible L200" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, James Holland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>